(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{202:function(e,t,n){e.exports=n(361)},207:function(e,t,n){},343:function(e,t){},353:function(e,t,n){},361:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),i=n(3),s=n.n(i),c=(n(207),n(369)),l=n(41),u=n(42),d=n(46),f=n(44),p=n(32),m=n.n(p),w=n(68),h=n(49),v=n.n(h),y=n(364),g=n(363),b=n(365),D=n(47),k=n(195),E=n(366),O=y.a.Search,S=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).openFilePreview=function(e){},a.closeFilePreview=function(){},a.kewordRef=o.a.createRef(),a.state={listData:a.props.listData||[],listInfo:a.props.listInfo||{},filePreview:!1,previewContent:""},a}return Object(u.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.listData,a=t.previewContent,r=t.filePreview,i=t.listInfo;return o.a.createElement("div",{style:{width:"100%",height:"100%"}},o.a.createElement(O,{placeholder:"search file",enterButton:"Search",size:"large",onSearch:function(t){return e.props.searchKeyword(t,i.pageNumber)},style:{width:"50%"},ref:this.kewordRef}),o.a.createElement(g.a,{title:"Preview",visible:r,onOk:this.closeFilePreview,onCancel:this.closeFilePreview},o.a.createElement("p",null,a)),o.a.createElement(b.b,{itemLayout:"vertical",size:"large",bordered:!0,dataSource:n,renderItem:function(t){return o.a.createElement(b.b.Item,{key:t.title,actions:[o.a.createElement(D.a,{type:"primary",onClick:function(){return e.props.downloadFile(t)},icon:o.a.createElement(E.a,null)},"Download")]},o.a.createElement(b.b.Item.Meta,{title:o.a.createElement(D.a,{type:"link",block:!0,onClick:function(){return e.openFilePreview(t.content)}},t.fileName),description:"type: ".concat(t.type," size: ").concat(t.size," peerId: ").concat(t.peerId)}))}}),o.a.createElement(k.a,{defaultCurrent:1,total:i.total/i.pageSize,onChange:function(t,n){e.props.searchKeyword(e.kewordRef.current.input.state.value,t)},defaultPageSize:1}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return JSON.stringify(e.listData)!==JSON.stringify(t.listData)||JSON.stringify(e.listInfo)!==JSON.stringify(t.listInfo)?{listData:e.listData,listInfo:e.listInfo}:null}}]),n}(r.Component),I=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={downloads:a.props.downloads||[]},a}return Object(u.a)(n,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(b.b,{itemLayout:"horizontal",dataSource:this.state.downloads,renderItem:function(t){return o.a.createElement(b.b.Item,null,o.a.createElement(b.b.Item.Meta,{title:t.fileName,description:"type: ".concat(t.type," createdOn: ").concat(new Date(t.createdOn))}),t.done?o.a.createElement(D.a,{type:"primary",onClick:function(){return e.props.deleteDownload(t._id,t._rev,t.fileName,!0)}},"Remove full download"):o.a.createElement(D.a,{type:"primary",onClick:function(){return e.props.handleDownload(t.fileHash,!t.start)}},t.start?"Stop":"Start"),t.start?null:o.a.createElement(D.a,{type:"primary",onClick:function(){return e.props.deleteDownload(t._id,t._rev,t.fileName)}},"Remove download"),0==t.peersInfo.length?"No Peers online":null)}}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return JSON.stringify(e.downloads)!==JSON.stringify(t.downloads)?{downloads:e.downloads}:null}}]),n}(r.Component),N=n(367),j=n(126),x=n.n(j),_=new(n(346).EventEmitter);function z(){return _}var C=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).componentDidMount=function(){a.getDownloads(),z().addListener("refresh_downloads",a.getDownloads)},a.componentWillUnmount=function(){z().removeListener("refresh_downloads")},a.searchKeyword=function(){var e=Object(w.a)(m.a.mark((function e(t,n){var r,o,i,s,c,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.state.listInfo,o={keyword:t,listData:[],listInfo:{total:0,pageNumber:1,pageSize:1}},n=a.state.keyword!==t?1:n,e.next=5,v.a.get("/sync/searchFiles?keyword=".concat(t,"&pageSize=").concat(r.pageSize,"&pageNumber=").concat(n));case 5:(i=e.sent)&&i.data&&i.data.result&&([],c=JSON.parse(JSON.stringify(a.state.listInfo)),l=i.data,s=l.result.map((function(e){return{peerId:e._source.appKey,content:e._source.content,fileName:e._source.filename,type:e._source.meta.type,size:e._source.meta.size,fileHash:e._source.meta.fileHash,piecesHash:e._source.meta.piecesHash}})),l.total&&(c.total=l.total),l.pageNumber&&(c.pageNumber=l.pageNumber),l.pageSize&&(c.pageSize=l.pageSize),o.listData=s,o.listInfo=c),a.setState(o);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.downloadFile=function(){var e=Object(w.a)(m.a.mark((function e(t){var n,r,o,i,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileHash,r=t.piecesHash,o=t.type,i=t.fileName,e.next=3,v.a.post("/sync/downloadFile",{fileHash:n,piecesHash:r,type:o,fileName:i});case 3:(s=e.sent)&&s.data&&s.data.success?(N.a.success(s.data.msg||"started"),a.getDownloads()):s&&s.data&&N.a.error(s.data.msg);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.getDownloads=Object(w.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get("/sync/getDownloads");case 2:(t=e.sent)&&t.data&&t.data.success&&t.data.downloads&&a.setState({downloads:t.data.downloads});case 4:case"end":return e.stop()}}),e)}))),a.handleDownload=function(){var e=Object(w.a)(m.a.mark((function e(t,n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.put("/sync/handleDownload",{fileHash:t,start:n});case 2:a.getDownloads();case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.deleteDownload=function(){var e=Object(w.a)(m.a.mark((function e(t,n,r){var o,i=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.length>3&&void 0!==i[3]&&i[3],e.next=3,v.a.delete("/sync/deleteDownload",{data:{_id:t,_rev:n,fileName:r,all:o}});case 3:a.getDownloads();case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),a.state={keyword:"",listData:[],listInfo:{total:0,pageNumber:1,pageSize:1},downloads:[]},a}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state,t=(e.keyword,e.listData),n=e.downloads,a=e.listInfo;return o.a.createElement("div",{style:H},o.a.createElement("div",{style:F},o.a.createElement(S,{searchKeyword:this.searchKeyword,listData:t,listInfo:a,downloadFile:this.downloadFile})),o.a.createElement("div",{style:P},o.a.createElement(I,{downloads:n,handleDownload:this.handleDownload,deleteDownload:this.deleteDownload})))}}]),n}(r.Component),F={display:"flex",flexDirection:"row",justifyContent:"center",width:"80%",height:"100%"},P={display:"flex",flexDirection:"row",width:"20%",height:"500px",overflow:"auto"},H={display:"flex",flexDirection:"row",justifyContent:"left",background:"#fff",height:"100%"},J=C,K=(n(353),n(354),function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this)).state={},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){x.a&&!a&&((a=x.a.connect("/")).on("connect",(function(){console.log("socket connected")})),a.on("refresh_downloads",(function(){_.emit("refresh_downloads")})))}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(c.c,null,o.a.createElement(c.a,{exact:!0,path:"/",component:J}),o.a.createElement(c.a,{exact:!0,path:"/home",component:J})))}}]),n}(r.Component)),R=n(194),M=n.n(R)()();v.a.interceptors.response.use((function(e){return e}),(function(e){return 401===e.response.status&&e.response.data&&e.response.data.Msg?e.response:e}));var L=function(){return o.a.createElement(c.b,{history:M},o.a.createElement(c.a,{path:"/",component:K}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[202,1,2]]]);
//# sourceMappingURL=main.08df7e37.chunk.js.map